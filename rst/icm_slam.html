
<!DOCTYPE html>

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ICM SLAM &#8212; documentación de Dynamic World - 0.2.0</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/translations.js"></script>
    <link rel="index" title="Índice" href="../genindex.html" />
    <link rel="search" title="Búsqueda" href="../search.html" />
    <link rel="next" title="Explicacion de como documentar usando las librerias de Sphinx" href="sphinx.html" />
    <link rel="prev" title="slam_benchmark.scripts.test" href="_autosummary/slam_benchmark.scripts.test.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="icm-slam">
<span id="id1"></span><h1>ICM SLAM<a class="headerlink" href="#icm-slam" title="Enlazar permanentemente con este título">¶</a></h1>
<div class="section" id="instalacion-icm-slam-ros">
<h2>Instalación ICM_SLAM + ROS<a class="headerlink" href="#instalacion-icm-slam-ros" title="Enlazar permanentemente con este título">¶</a></h2>
<p>A continuación se desarrollan los pasos que hay que seguir para poder ejecutar el algoritmo ICM_SLAM en una red ROS.</p>
<blockquote>
<div><ul class="simple">
<li><p>Inicialmente es necesario instalar <a class="reference external" href="https://docs.docker.com/get-docker/">Docker</a></p></li>
<li><p>Descargar la última versión de la <a class="reference external" href="https://www.mediafire.com/file/esaom1qt9yf2lyh/ros_implementation_v2_1.zip/file">implementación en ros</a></p></li>
<li><p>Descomprima el archivo .zip descargado. Abra una terminal del sistema operativo y dirijase a la carpeta en donde descomprimió el archivo.</p></li>
<li><p>Luego ingrese el siguiente comando:</p></li>
</ul>
</div></blockquote>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker build -t ros-bridge .
</pre></div>
</div>
<p>Se van a descargar unos paquetes, esta operación puede tardar mucho tiempo. Depende de su velocidad de conexión.</p>
<blockquote>
<div><ul class="simple">
<li><p>Una vez que finalice el anterior paso, ejecutar:</p></li>
</ul>
</div></blockquote>
<div class="highlight-bash notranslate" id="launch-ros-bridge"><div class="highlight"><pre><span></span>docker-compose up -d
</pre></div>
</div>
<p>Este comando va a crear una red ROS funcionando en background. Es necesario que quede corriendo mientras se trabaja con ROS ya que además de generar un puente entre la virtualización (mediante Docker) y la maquina host, corre tambien <em>roscore</em>. Esta última aplicación es necesaria para que funcione ROS.
Para desactivarlo, ingrese el siguiente comando:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker-compose down
</pre></div>
</div>
<p>En esta misma carpeta hay otra carpeta que se llama «bags». Esta es una carpeta compartida con la virtualizacion, los datos almacenados en la carpeta «bags» apareceran en la carpeta «/home» de la virtualizacion. Si desea compartir otra carperta debe modificar el archivo docker-compose.yml y en la linea donde dice «source: ./bags» rempleazar ./bags por la ruta de la carpeta que desea compartir.</p>
<blockquote>
<div><ul class="simple">
<li><p>Para reproducir un archivo <em>.bag</em> ejecutar en otra terminal:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker <span class="nb">exec</span> -it docker_ros-bridge_1 bash
</pre></div>
</div>
</div></blockquote>
<p>Luego, una vez dentro de la virtualización ingresar los siguientes comandos en orden:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /home
<span class="nb">source</span> iniciar.sh
</pre></div>
</div>
</div></blockquote>
<p>Ahora ya se esta en condiciones de ejecutar cualquier archivo .bag, por ejemplo lo puede hacer de la siguiente manera:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rosbag play data.bag
</pre></div>
</div>
</div></blockquote>
<p>Esto reproducirá la grabación almacenada en <em>data.bag</em> . Si preciona la tecla <em>space</em> la repdocucción se pausará. Si preciona la combinación de teclas <em>ctrl+c</em> se corta la reproducción.</p>
<p>Una vez de realizado el anterior procedimiento, se esta en condiciones de probar el algoritmo <em>icm_slam</em>. Para esto descargar la última versión disponible en <a class="reference external" href="https://www.mediafire.com/file/yi6tg57fel15laz/ros_bridge_v2_1.zip/file">icm_slam</a> e instalar <a class="reference external" href="https://www.python.org/downloads/">Python 3</a> si es que no lo tiene aún. Luego siga las siguientes instrucciones:</p>
<blockquote>
<div><ul class="simple">
<li><p>Descomprimir el archivo.</p></li>
<li><p>En la carpeta que descomprimió el archivo ejecutar los siguientes comandos para preparar el entorno de ejecución:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3 -m venv env
<span class="nb">source</span> env/bin/activate
python -m pip install -U pip
python3 -m pip install -r requisitos.txt
</pre></div>
</div>
</div></blockquote>
<p>Ya se esta en condiciones de ejecutar el algoritmo. Para esto, debe poner en funcionamiento la virtualización (mediante el comando <a class="reference internal" href="#launch-ros-bridge"><span class="std std-ref">launch ros_bridge</span></a>), luego en la carpeta donde descomprimió ejecutar:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python example.bag
</pre></div>
</div>
</div></blockquote>
<p>Si todo funciona correctamente debería salir el mensaje: «Conectado a la red ROS».</p>
<blockquote>
<div><ul class="simple">
<li><p>Cuando se comience a reproducir una base de datos, el código de python comenzará a recibir la información y creará una imagen con la trayectoria y el mapa estimado.</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="procedimiento-de-ejecucion-sin-docker">
<h2>Procedimiento de ejecución sin Docker<a class="headerlink" href="#procedimiento-de-ejecucion-sin-docker" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Este package no es propiamente un package de ROS, ya que no requiere tener inicializado el entorno. Para usar los scripts con la red ROS se requiere estar corriendo en <em>ros-master</em> el modulo <a class="reference external" href="http://wiki.ros.org/rosbridge_suite">rosbridge</a>. Una vez instalado este modulo ejecutar:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>roslaunch rosbridge_server rosbridge_websocket.launch
</pre></div>
</div>
<p>A modo de resumen, rosbridge es una inteerfaz de ROS que permite conectar a la red programas que no contienen modulos de ROS. En este caso se utiliza la libreria <a class="reference external" href="https://roslibpy.readthedocs.io/en/latest/">roslibpy</a> ya que permite conectar códigos escritos en python 3.xx a ROS (ROS funciona con python 2.7).</p>
<p>Una vez inicializado <em>rosbridge</em> el modulo <em>sensors.py</em> busca conectarse a la red ROS y accede a los topics de los sensores. Por defecto busca el topic del laser y de la odometría, los cuales deben especificarse en el archivo de configuración <em>config_ros.yaml</em> en <em>topic_laser</em> y <em>topic_odometry</em> respectivamente.</p>
<p>El software no diferencia si los datos vienen de una simulación que esta corriendo, si son datos de un robot que está compartiendo los datos de sus sensores via streaming, o son datos grabados en un archivo <em>.bag</em>. Por este motivo en esta ocasión se utiliza la última opción.</p>
<p>Ya sea con <em>ros_bridge</em> implementado en Docker, o directamente desde la máquina host, para reproducir un archivo <em>.bag</em> hacer:
..
Aún no está implementada la posibilidad de de ejecutar un <em>.bag</em> sin tener funcionando la red ROS. Con lo cual, se requiere tener instalado ROS para ejecutar el siguiente comando:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rosbag play slam_benchmark/bags/laser_data.bag
</pre></div>
</div>
<p>Asumiendo que el <em>PWD</em> está en la carpeta <em>src</em> del <em>workspace</em>. Luego lanzar el script haciendo:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> ICM_SLAM/scripts/env/bin/activate
python ICM_SLAM/scripts/sensors.py
</pre></div>
</div>
</div>
<div class="section" id="funcionamiento-script-sensors-py">
<h2>Funcionamiento script sensors.py<a class="headerlink" href="#funcionamiento-script-sensors-py" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Este script se subscribe a los topics antes dichos y genera un servicio que habilita las iteraciones ICM. (Esto se podrá implementar en un futuro con  <a class="reference external" href="http://wiki.ros.org/actionlib">ActionLib</a> más info en <a class="reference external" href="http://wiki.ros.org/actionlib/DetailedDescription">ActionLib Detailed Description.</a>).</p>
<p>Básicamente el comportamiento del servicio es que mediante el comando «start», comienza a iterar la cantidad de veces especificadas en el <em>.yaml</em> y luego devuelve el mapa y la trayectoria del vehículo.Para dar el comando mediante la red ROS, ejecutar el siguiente comando:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rosservice call /icm_slam/iterative_flag <span class="nb">true</span>
</pre></div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Dynamic World</a></h1>








<h3>Navegación</h3>
<p class="caption"><span class="caption-text">Contenido:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="pioneer2dx.html">Pioneer2dx</a></li>
<li class="toctree-l1"><a class="reference internal" href="campo.html">Campo</a></li>
<li class="toctree-l1"><a class="reference internal" href="sm_bk.html">Slam Benchmark</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">ICM SLAM</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#instalacion-icm-slam-ros">Instalación ICM_SLAM + ROS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#procedimiento-de-ejecucion-sin-docker">Procedimiento de ejecución sin Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="#funcionamiento-script-sensors-py">Funcionamiento script sensors.py</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="sphinx.html">Explicacion de como documentar usando las librerias de <em>Sphinx</em></a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="_autosummary/slam_benchmark.scripts.test.html" title="capítulo anterior">slam_benchmark.scripts.test</a></li>
      <li>Next: <a href="sphinx.html" title="próximo capítulo">Explicacion de como documentar usando las librerias de <em>Sphinx</em></a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Búsqueda rápida</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Ir a" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Sansoni S..
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.5.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/rst/icm_slam.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>